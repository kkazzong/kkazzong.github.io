package com.kkaboard.api.server.test.board;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.mock.web.MockHttpServletResponse;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;

import com.kkaboard.api.server.controller.BoardController;
import com.kkaboard.api.server.dto.input.BoardInputDto;
import com.kkaboard.api.server.service.BoardService;

import lombok.extern.slf4j.Slf4j;

@AutoConfigureMockMvc
@SpringBootTest
@Slf4j
public class BoardTest {
	
	@Autowired
	private MockMvc mockMvc;
	
	@Autowired
	private BoardController boardController;
	
	@Autowired
	private BoardService boardService;
	
	@DisplayName("보드서비스 컨텍스트로드")
	@Test
	void contextLoads() {
		assert boardService != null && boardController != null;
	}
	
	@DisplayName("게시판 추가 서비스")
	//@Test
	public void add() throws Exception{
		BoardInputDto input = new BoardInputDto();
		input.setWriter_name("스프링부트테스트");
		input.setBoard_password("asdf1234");
		input.setTitle("안녕?");
		input.setContent("하세여?");
		
		assert boardService.addBoard(input) == 1; 
	}
	
	@DisplayName("게시판 추가 컨트롤")
	@Test
	public void addC() throws Exception{
		String url = "/board/add-board";
		BoardInputDto input = new BoardInputDto();
		input.setWriter_name("스프링부트테스트");
		input.setBoard_password("asdf1234");
		input.setTitle("안녕?");
		input.setContent("하세여?");
		
		mockMvc.perform(MockMvcRequestBuilders.post(url))
				.andExpect(result -> {
					MockHttpServletResponse res = result.getResponse();
					log.info(res.toString());
				});
			
	}
}
